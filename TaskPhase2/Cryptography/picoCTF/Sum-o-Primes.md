# Sum-o-Primes

## Method

```
We have so much faith in RSA we give you not just the product of the primes, but their sum as well!
gen.py
output.txt
```
**Hint1:** I love squares :)

gen.py file
```python
#!/usr/bin/python

from binascii import hexlify
from gmpy2 import mpz_urandomb, next_prime, random_state
import math
import os
import sys

if sys.version_info < (3, 9):
    import gmpy2
    math.gcd = gmpy2.gcd
    math.lcm = gmpy2.lcm

FLAG  = open('flag.txt').read().strip()
FLAG  = int(hexlify(FLAG.encode()), 16)
SEED  = int(hexlify(os.urandom(32)).decode(), 16)
STATE = random_state(SEED)

def get_prime(bits):
    return next_prime(mpz_urandomb(STATE, bits) | (1 << (bits - 1)))

p = get_prime(1024)
q = get_prime(1024)

x = p + q
n = p * q

e = 65537

m = math.lcm(p - 1, q - 1)
d = pow(e, -1, m)

c = pow(FLAG, e, n)

print(f'x = {x:x}')
print(f'n = {n:x}')
print(f'c = {c:x}')
```

output.txt file
```
x = 1626a189dcb38ca6b8e9ee26623ab5c3c6cd7e4c7ff6726f4b03831ca48c617a056827c5763458d0aa7172650072b892649cc73f943f156b795ff5dd2fc9a53b140cf9c3ee2cbb8181d17bb0275f404b4090766f798ad156db7e71000e93db65f3e1bc7406532d0f509fbecf095ef215b4ad51f5e8ac765861e5f93808948bf72
n = 720d66204ec312d7f1bc688495d4585ec58520170b86ed3488c3f9c76407b7e9e466b82a282ba90d484698160f2e27f413b07cf8805d560abdffa977547d5fec3190a1ce284dfc8e92193f2f70590bf9c6e6d0ab449e35ef43ed20232b7f8686696125cde1f950230fbc6858392a3715c1b8a4947748b7fadd5cc921716ad5e0129c91ea88fceee140fb1c594606186afacb69143ef8f7b3b1aa2cc3206395c60e71ec0555dd15838d8a8395e8ccf9a4e4c4199ae0ab3f8af7ebc6605edc5ddd480be2d6c41e38618eba5822a1e566080877268802750de71e890ac865ebf87fdc290d9151e407dff4c97390c9e7388fd538e2716515cea2240f55963c2e0c21
c = 554b90eb12fbece709d7bf23ab91f9b52d71cd77fbf42f65d68623c2055d99956b9bcf2eaf14771fa5781fae86624e44b452a0f68768849faba1b9695ce353a17238a3e7040ee7aede68b35bf4b51daf0982653910b280ac98aad9a5b3c49d226e10b2e8660effc2cb2a553039bde527e42f1795bc078af6ed2928505be6df1ebe993f2ed8c10477dd5cc9f899d1e69b6512b71c732472dde521f5393c76b2f9fbed668560d4e50ca177dd14b923414549d688b20fab94dba7cad7b5a729941c772dc4a1db79b0e6a111d2d2e8998b4e2a272dc940a9dd4cf856faa5a2ee0cb6f36f0ce6edbb421697e517a4d589cc5a880eecf6fbf65e5f6a1a437b06e5ff9a
```

Mapping the encryption file and the output.txt file we see several things at first

x = p + q
n = p * q
e = 65537

c = ciphertext

Upon looking closer at the x n and c we realise they are in hexadecimal form meaning we should conver them first to decimal

```
x =
248878282147479407631683581202119202008113857267648242816387280016661770909433559540391540904735766035014251753170725650780440980606643804373951958290034800751257829018523044830468122826389084287622708715254713223303522388570617378324063310896161346186050183368553578353692887898281853413705176162420652556146
n = 14397774025004225993324435373479841323143935975053346165517984090132297018624689312592691344102355968341136940317334933016992680426294169407626539184359084321074000040939965885430451277187344911666759551422649486209938298125446066534891745094531222859443430894079142245216081256486936874280817564862769893645780979857446157952422613983118722910792157813441058095267855284014352295404885937555564838474289235824366704530230965338041116831007627876405345147820235814226436949637129018549397122198900007109231871447754296433655123133738574450189441923114132909194938534073968797793393952515066289029146527460197279861793
c =
10767518948400542289199359183436712557591742088542679960571985060771016792406423835929446015723661095003465381803884657321530119321089967418372597707592773233290582961156392976711630885216154864291047459953297145208271108555557366324096204493693420291458717973059523267471691238114194003194471127184972246206446213395202678582016307558055877790950385413047220689590763872472133350439594360800329622870115851299423804846716396162400806509508945597592204229494523372153318155789755309829460023574680548937539776435314920738174771346687931578778968379605539118535524185013759344401938978542550856069495312394416535502746
```

Now this is alot easier than it seems as we know that to decrypt a cipher text we need the private key.

Which is calculated with ``d = e^(-1) (mod φ(n))`` now this φ(n) is composed of ``(p-1)(q-1)`` 
Now suprisingly upon multiplying this out we get the equation ``(pxq)-(px1)-(qx1)+1`` which also means ``(p x q) - (p + q) + 1``

From here its pretty easy to solve as we know ``p x q`` = n and ``p + q`` = x

Hence we can just solve this directly

```python
x = 248878282147479407631683581202119202008113857267648242816387280016661770909433559540391540904735766035014251753170725650780440980606643804373951958290034800751257829018523044830468122826389084287622708715254713223303522388570617378324063310896161346186050183368553578353692887898281853413705176162420652556146
n = 14397774025004225993324435373479841323143935975053346165517984090132297018624689312592691344102355968341136940317334933016992680426294169407626539184359084321074000040939965885430451277187344911666759551422649486209938298125446066534891745094531222859443430894079142245216081256486936874280817564862769893645780979857446157952422613983118722910792157813441058095267855284014352295404885937555564838474289235824366704530230965338041116831007627876405345147820235814226436949637129018549397122198900007109231871447754296433655123133738574450189441923114132909194938534073968797793393952515066289029146527460197279861793
c = 10767518948400542289199359183436712557591742088542679960571985060771016792406423835929446015723661095003465381803884657321530119321089967418372597707592773233290582961156392976711630885216154864291047459953297145208271108555557366324096204493693420291458717973059523267471691238114194003194471127184972246206446213395202678582016307558055877790950385413047220689590763872472133350439594360800329622870115851299423804846716396162400806509508945597592204229494523372153318155789755309829460023574680548937539776435314920738174771346687931578778968379605539118535524185013759344401938978542550856069495312394416535502746

e = 65537
toit = n - x + 1
d = pow(e, -1, toit) # Private Key
plain = pow(c, d, n) # Decrypting cipher text
print(plain)

decrypted_bytes = plain.to_bytes((plain.bit_length() + 7) // 8, 'big') # This converts the integer m to a byte sequence. The number of bytes required is calculated based on the bit length of m

try:
    decrypted_message = decrypted_bytes.decode('ascii') # This converts the byte sequence into a human-readable string.
    print(f"Decrypted message: {decrypted_message}")
except UnicodeDecodeError:
    print("Decrypted message cannot be decoded as a string.")
```
 
Running this returns us 

```
19023464378915228186961971911578673930414528675538075162786456500620236949484333128408678850102656856786656732489532083233175421
Decrypted message: picoCTF{pl33z_n0_g1v3_c0ngru3nc3_0f_5qu4r35_92fe3557}
```


## Flag

> picoCTF{pl33z_n0_g1v3_c0ngru3nc3_0f_5qu4r35_92fe3557}