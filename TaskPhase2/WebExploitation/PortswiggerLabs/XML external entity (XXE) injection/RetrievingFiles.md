# Exploiting XXE using external entities to retrieve files

## Method

``This lab has a "Check stock" feature that parses XML input and returns any unexpected values in the response.``
``To solve the lab, inject an XML external entity to retrieve the contents of the /etc/passwd file.``

This is similar to the SOAP challenge done on picoctf.

To do this we can first open up burpsutie.

Upon putting the website into the burp suite browser we can first turn on intercept. This lab has a "Check stock" feature that uses XML and hence this is what we are required to
exploit. Upon opening this into the repeater section we can identify what the xml code is.

```
<?xml version="1.0" encoding="UTF-8"?>
<stockCheck>
   <productId>
     1
   </productId>
   <storeId>
     1
   </storeId>
</stockCheck>

```

Upon seeing this we can do 2 things. One is insert our external entity 
`` <!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>  ``

and It essentially creates an entity named xxe that points to the /etc/password file on the web server.
We then pass use the numbers in productId and storeId to contain our payload which will recieve the file contents of ``/etc/passwd``.
we can name this *&xxe;*

this essentially: 
- Introduces a DOCTYPE element that defines an external entity containing the path to the file.
- uses a data value in the XML that is returned in the application's response, to make use of the defined external entity

XXE payload defines an external entity &xxe; whose value is the contents of the /etc/passwd file and uses the entity within the productId value.

![image](https://github.com/user-attachments/assets/d29fc4bb-a64d-4d05-9a1c-56f08ede4dce)

Hence we can then see on the port swigger website that it has been solved.

![image](https://github.com/user-attachments/assets/e86d7eca-310d-4e32-88da-359f76d9e0f9)

---
